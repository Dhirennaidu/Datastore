<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IndexedDB CRUD Operations</title>
    <style>
        body {
            font-family: sans-serif;
        }
        #data-list {
            list-style: none;
            padding: 0;
        }
        #data-list li {
            border: 1px solid #ccc;
            padding: 10px;
            margin-bottom: 5px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .actions button {
            margin-left: 5px;
            cursor: pointer;
        }
        #edit-form {
            display: none;
            margin-top: 20px;
            border: 1px solid #eee;
            padding: 15px;
        }
        #edit-form label {
            display: block;
            margin-bottom: 5px;
        }
        #edit-form input[type="text"],
        #edit-form input[type="number"] {
            width: 100%;
            padding: 8px;
            margin-bottom: 10px;
            box-sizing: border-box;
        }
    </style>
</head>
<body>
    <h1>IndexedDB CRUD Operations</h1>

    <div id="input-section">
        <h2>Add New Item</h2>
        <label for="name">Name:</label>
        <input type="text" id="name"><br><br>
        <label for="value">Value:</label>
        <input type="number" id="value"><br><br>
        <button onclick="addItem()">Add Item</button>
    </div>

    <div id="data-display">
        <h2>Items</h2>
        <ul id="data-list">
            </ul>
    </div>

    <div id="edit-form">
        <h2>Edit Item</h2>
        <form id="update-form">
            <input type="hidden" id="edit-id">
            <label for="edit-name">Name:</label>
            <input type="text" id="edit-name"><br><br>
            <label for="edit-value">Value:</label>
            <input type="number" id="edit-value"><br><br>
            <button type="button" onclick="updateItem()">Update Item</button>
            <button type="button" onclick="cancelEdit()">Cancel</button>
        </form>
    </div>

    <script>
      const dbName = 'itemDatabase';
const objectStoreName = 'items';
let db;
const dataList = document.getElementById('data-list');
const editForm = document.getElementById('edit-form');
const updateForm = document.getElementById('update-form');
let currentItemId;

// Initialize IndexedDB
const request = indexedDB.open(dbName, 1);

request.onerror = (event) => {
    console.error('Error opening database:', event.target.errorCode);
};

request.onsuccess = (event) => {
    db = event.target.result;
    console.log('Database opened successfully.');
    displayItems();
};

request.onupgradeneeded = (event) => {
    const db = event.target.result;
    if (!db.objectStoreNames.contains(objectStoreName)) {
        const objectStore = db.createObjectStore(objectStoreName, { keyPath: 'id', autoIncrement: true });
        objectStore.createIndex('name', 'name', { unique: false });
        console.log('Object store created.');
    }
};

// CREATE operation
function addItem() {
    const nameInput = document.getElementById('name');
    const valueInput = document.getElementById('value');
    const name = nameInput.value.trim();
    const value = parseInt(valueInput.value);

    if (name) {
        const transaction = db.transaction([objectStoreName], 'readwrite');
        const objectStore = transaction.objectStore(objectStoreName);
        const newItem = { name: name, value: value };
        const addRequest = objectStore.add(newItem);

        addRequest.onsuccess = () => {
            console.log('Item added successfully.');
            nameInput.value = '';
            valueInput.value = '';
            displayItems();
        };

        addRequest.onerror = (event) => {
            console.error('Error adding item:', event.target.errorCode);
        };
    } else {
        alert('Please enter a name.');
    }
}

// READ operation (display all items)
function displayItems() {
    dataList.innerHTML = ''; // Clear the current list
    const transaction = db.transaction([objectStoreName], 'readonly');
    const objectStore = transaction.objectStore(objectStoreName);
    const getAllRequest = objectStore.getAll();

    getAllRequest.onsuccess = (event) => {
        const items = event.target.result;
        items.forEach(item => {
            const listItem = document.createElement('li');
            listItem.innerHTML = `
                <span>${item.name}: ${item.value}</span>
                <div class="actions">
                    <button onclick="editItem(${item.id})">Edit</button>
                    <button onclick="deleteItem(${item.id})">Delete</button>
                </div>
            `;
            dataList.appendChild(listItem);
        });
    };

    getAllRequest.onerror = (event) => {
        console.error('Error fetching items:', event.target.errorCode);
    };
}

// UPDATE operation (show edit form)
function editItem(id) {
    currentItemId = id;
    editForm.style.display = 'block';

    const transaction = db.transaction([objectStoreName], 'readonly');
    const objectStore = transaction.objectStore(objectStoreName);
    const getRequest = objectStore.get(id);

    getRequest.onsuccess = (event) => {
        const item = event.target.result;
        if (item) {
            document.getElementById('edit-name').value = item.name;
            document.getElementById('edit-value').value = item.value;
            document.getElementById('edit-id').value = item.id;
        } else {
            console.log('Item not found for editing.');
            editForm.style.display = 'none';
        }
    };

    getRequest.onerror = (event) => {
        console.error('Error fetching item for edit:', event.target.errorCode);
    };
}

// UPDATE operation (submit updated data)
function updateItem() {
    const editNameInput = document.getElementById('edit-name');
    const editValueInput = document.getElementById('edit-value');
    const id = parseInt(document.getElementById('edit-id').value);
    const updatedName = editNameInput.value.trim();
    const updatedValue = parseInt(editValueInput.value);

    if (updatedName) {
        const transaction = db.transaction([objectStoreName], 'readwrite');
        const objectStore = transaction.objectStore(objectStoreName);
        const updatedItem = { id: id, name: updatedName, value: updatedValue };
        const updateRequest = objectStore.put(updatedItem);

        updateRequest.onsuccess = () => {
            console.log('Item updated successfully.');
            editForm.style.display = 'none';
            displayItems();
        };

        updateRequest.onerror = (event) => {
            console.error('Error updating item:', event.target.errorCode);
        };
    } else {
        alert('Please enter a name to update.');
    }
}

function cancelEdit() {
    editForm.style.display = 'none';
}

// DELETE operation
function deleteItem(id) {
    if (confirm('Are you sure you want to delete this item?')) {
        const transaction = db.transaction([objectStoreName], 'readwrite');
        const objectStore = transaction.objectStore(objectStoreName);
        const deleteRequest = objectStore.delete(id);

        deleteRequest.onsuccess = () => {
            console.log('Item deleted successfully.');
            displayItems();
        };

        deleteRequest.onerror = (event) => {
            console.error('Error deleting item:', event.target.errorCode);
        };
    }
}
    </script>
</body>
</html>